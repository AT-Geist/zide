#!/usr/bin/env bash

read -r -d '' HELP_TEXT << EOF
Usage: $(basename "$0") [OPTIONS] <working_dir>

Optional Parameters:
	<working_dir>     Optionally specify a working directory to open yazi into:

Options:
  -h, --help        Show this help message and exit.

Environment Variables:
  ZIDE_YAZI_CONFIG  Custom yazi config file location to customize yazi on
                    launch. Only used when using yazi as your picker.

Description:
  Convenience wrapper that handles generating a space-separated list of paths
  from Yazi.
EOF

if ! command -v yazi &> /dev/null; then
  echo "Error: 'yazi' is not installed or not in your PATH." >&2
  exit 1
fi

working_dir=${1}

# Yazi picker config location
yaziConfig=${ZIDE_YAZI_CONFIG:-"${ZIDE_DIR}/yazi"}

# Point yazi to the config directory for opening as a single layout pane
export YAZI_CONFIG_HOME="${yaziConfig}"

# Use yazi to pick our files
echo $(yazi ${working_dir} --chooser-file=/dev/stdout | while read -r; do printf "%q " "$REPLY"; done)
