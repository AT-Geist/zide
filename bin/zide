#!/usr/bin/env bash

# Configurable constants
# 
# Default layout. Available layouts can be found in the zide layouts/ directory
ZIDE_DEFAULT_LAYOUT="ide_compact"

# Optional params
# 
# Working directory to open in, defaults to pwd
cwd=${1:-$(pwd)} 
# Layout to use
layout=${2:-$ZIDE_DEFAULT_LAYOUT} 

# Figure out where zide is installed based on where the script lives
if command -v readlink >/dev/null 2>&1; then
  script_dir=$(dirname "$(readlink -f "$0")")
else
  script_dir=$(cd -- "$(dirname -- "$0")" && pwd)
fi

# Export location of the zide project files for further use
export ZIDE_DIR=$(dirname "$script_dir")

layout_path="$ZIDE_DIR/layouts/$layout"
if [ -n "$ZELLIJ" ]; then
  zellij action new-tab --cwd $cwd --layout "$layout_path"
else
  # No way to specify the working dir to the zellij CLI, so we change the working dir before opening
  # zellij, and change it back once we exit
  pushd $cwd > /dev/null
    zellij --layout "$layout_path"
  popd > /dev/null
fi
